import{j as t}from"./jsx-runtime-0DLF9kdB.js";import{r as u,L as y}from"./components-CZEx2DQX.js";import{I as O}from"./index-Don8BO6t.js";import{f as H}from"./favicon-CG_43MKL.js";import"./preload-helper-ckwbz45p.js";function _(e,c){var a=u.useRef(null),i=u.useRef(null);i.current=c;var l=u.useRef(null);u.useEffect(function(){n()});var n=u.useCallback(function(){var s=l.current,r=i.current,o=s||(r?r instanceof Element?r:r.current:null);a.current&&a.current.element===o&&a.current.subscriber===e||(a.current&&a.current.cleanup&&a.current.cleanup(),a.current={element:o,subscriber:e,cleanup:o?e(o):void 0})},[e]);return u.useEffect(function(){return function(){a.current&&a.current.cleanup&&(a.current.cleanup(),a.current=null)}},[]),u.useCallback(function(s){l.current=s,n()},[n])}function p(e,c,a){return e[c]?e[c][0]?e[c][0][a]:e[c][a]:c==="contentBoxSize"?e.contentRect[a==="inlineSize"?"width":"height"]:void 0}function T(e){e===void 0&&(e={});var c=e.onResize,a=u.useRef(void 0);a.current=c;var i=e.round||Math.round,l=u.useRef(),n=u.useState({width:void 0,height:void 0}),s=n[0],r=n[1],o=u.useRef(!1);u.useEffect(function(){return o.current=!1,function(){o.current=!0}},[]);var f=u.useRef({width:void 0,height:void 0}),m=_(u.useCallback(function(d){return(!l.current||l.current.box!==e.box||l.current.round!==i)&&(l.current={box:e.box,round:i,instance:new ResizeObserver(function(x){var g=x[0],h=e.box==="border-box"?"borderBoxSize":e.box==="device-pixel-content-box"?"devicePixelContentBoxSize":"contentBoxSize",v=p(g,h,"inlineSize"),R=p(g,h,"blockSize"),j=v?i(v):void 0,N=R?i(R):void 0;if(f.current.width!==j||f.current.height!==N){var C={width:j,height:N};f.current.width=j,f.current.height=N,a.current?a.current(C):o.current||r(C)}})}),l.current.instance.observe(d,{box:e.box}),function(){l.current&&l.current.instance.unobserve(d)}},[e.box,i]),e.ref);return u.useMemo(function(){return{ref:m,width:s.width,height:s.height}},[m,s.width,s.height])}const $=T,B=e=>{const c=u.useRef(null),a=u.useRef(null),i=u.useRef(null);$({ref:c,onResize:({width:r=0,height:o=0})=>{var f;e.onResize?e.onResize(i.current,r,o):(f=i.current)==null||f.resize(r,o-3)}});const l=u.useCallback(()=>{const{data:r,marks:o,waterfall:f,timeseries:m,settings:d,colors:x,plugins:g,timeframeTimeseries:h}=e;if(a.current&&c.current){const{width:v=0,height:R=0}=c.current.getBoundingClientRect();a.current.width=v,a.current.height=R-3,i.current=new flameChartJs.FlameChart({canvas:a.current,data:r,marks:o,waterfall:f,timeseries:m,timeframeTimeseries:h,settings:d,colors:x,plugins:g})}},[e]),n=u.useCallback(r=>{const o=r!==c.current;c.current=r,o&&l()},[l]),s=u.useCallback(r=>{const o=r!==a.current;a.current=r,o&&l()},[l]);return u.useEffect(()=>{var r;e.data&&((r=i.current)==null||r.setNodes(e.data))},[e.data]),u.useEffect(()=>{var r;e.marks&&((r=i.current)==null||r.setMarks(e.marks))},[e.marks]),u.useEffect(()=>{var r;e.waterfall&&((r=i.current)==null||r.setWaterfall(e.waterfall))},[e.waterfall]),u.useEffect(()=>{var r;e.timeseries&&((r=i.current)==null||r.setTimeseries(e.timeseries))},[e.timeseries]),u.useEffect(()=>{var r;e.timeframeTimeseries&&((r=i.current)==null||r.setTimeframeTimeseries(e.timeframeTimeseries))},[e.timeframeTimeseries]),u.useEffect(()=>{e.settings&&i.current&&(i.current.setSettings(e.settings),i.current.renderEngine.recalcChildrenSizes(),i.current.render())},[e.settings]),u.useEffect(()=>{var r;e.position&&((r=i.current)==null||r.setFlameChartPosition(e.position))},[e.position]),u.useEffect(()=>{var r;e.zoom&&((r=i.current)==null||r.setZoom(e.zoom.start,e.zoom.end))},[e.zoom]),u.useEffect(()=>{var r;return e.onSelect&&((r=i.current)==null||r.on("select",e.onSelect)),()=>{var o;e.onSelect&&((o=i.current)==null||o.removeListener("select",e.onSelect))}},[e.onSelect]),t.jsx("div",{style:{height:"100%"},className:e.className,ref:n,children:t.jsx("canvas",{ref:s})})};let F=0;const E="/debug-network-server",I="h2-debug-network-settings";function L(){try{return JSON.parse(localStorage.getItem(I)??"{}")}catch{return{}}}function q(e){localStorage.setItem(I,JSON.stringify({...L(),...e}))}function D(){const e=u.useRef({mainRequests:[],subRequests:{},allRequests:{},hidePutRequests:!0,preserveLog:!1,activeEventId:void 0,hideNotification:void 0}),[c,a]=u.useState();function i(){a(new Date().getTime())}u.useEffect(()=>{try{const d=L();e.current.hidePutRequests=d.hidePutRequests??!0,e.current.preserveLog=d.preserveLog??!1,e.current.hideNotification=d.hideNotification??void 0,i()}catch{}},[]);function l(){fetch(E,{method:"DELETE"}).catch(d=>console.error("Could not clear history:",d)),e.current={...e.current,mainRequests:[],subRequests:{},allRequests:{},activeEventId:void 0}}function n(d){return x=>{const g=JSON.parse(x.data),h=`event-${F++}`;d({...g,id:h}),setTimeout(i,0)}}u.useEffect(()=>{const d=new EventSource(E,{withCredentials:!0}),x=n(h=>{const v={...h,url:h.url.replace(location.origin,"")};e.current.preserveLog?e.current.mainRequests=[...e.current.mainRequests,v]:e.current.mainRequests=[v],e.current.allRequests[v.id]=v});d.addEventListener("Request",x);const g=n(h=>{let v=e.current.subRequests[h.requestId]||[];v=[...v,h],e.current.subRequests={...e.current.subRequests,[h.requestId]:v},e.current.allRequests[h.id]=h});return d.addEventListener("Sub request",g),()=>{d.removeEventListener("Request",x),d.removeEventListener("Sub request",g),d.close()}},[]);function s(){l(),i()}function r(d){e.current.hidePutRequests=d,q({hidePutRequests:d}),i()}function o(d){e.current.preserveLog=d,q({preserveLog:d}),i()}function f(d){e.current.activeEventId=d}function m(d){e.current.hideNotification=d,q({hideNotification:d}),i()}return{serverEvents:e.current,clear:s,setHidePutRequests:r,setPreserveLog:o,setActiveEventId:f,setHideNotification:m,timestamp:c}}function P({serverEvents:e,buildMainRequest:c,buildSubRequest:a}){const i=n=>{var s;return n-(((s=e.mainRequests[0])==null?void 0:s.startTime)??0)};let l=[];return e.mainRequests.forEach(n=>{const s=i(n.endTime);let r=s;const o=[];(e.subRequests[n.requestId]||[]).forEach(m=>{const d=i(m.endTime);m.cacheStatus!=="PUT"&&(r=Math.max(r,d));const x=a(m,{requestStart:i(m.startTime),requestEnd:d,responseStart:-1,responseEnd:-1});e.hidePutRequests?m.cacheStatus!=="PUT"&&o.push(x):o.push(x)}),l.push(c(n,{requestStart:i(n.startTime),responseStart:s,responseEnd:r,requestEnd:-1})),l=l.concat(o)}),l}const w="10px Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Open Sans, Helvetica Neue, sans-serif";let k;function M({serverEvents:e,config:c}){const a=P({serverEvents:e,buildMainRequest:(s,r)=>({name:s.url,intervals:"mainRequest",timing:r,meta:[{name:"id",value:s.id,color:"black"}]}),buildSubRequest:(s,r)=>({name:`${s.cacheStatus} ${s.displayName??s.url}`.trim(),intervals:"request",timing:r,meta:[{name:"id",value:s.id,color:"black"}]})}),i={items:[{name:"padding-request",intervals:"request",timing:{requestStart:0,responseStart:0,responseEnd:0,requestEnd:-1}},...a],intervals:{mainRequest:[{name:"server",color:c.colors.server,type:"block",start:"requestStart",end:"responseStart"},{name:"streaming",color:c.colors.streaming,type:"block",start:"responseStart",end:"responseEnd"}],request:[{name:"request",color:c.colors.subRequest,type:"block",start:"requestStart",end:"requestEnd"}]}},l=s=>{var o,f,m;const r=(m=(f=(o=s==null?void 0:s.node)==null?void 0:o.meta)==null?void 0:f.filter(d=>d.name==="id"))==null?void 0:m[0];r&&setTimeout(()=>{var d;window.setActiveEventId&&window.setActiveEventId(r.value),(d=document.querySelector(`#request-table__row-${r.value}`))==null||d.scrollIntoView()},0)},n=u.useMemo(()=>({options:{tooltip:()=>{}},styles:{main:{blockHeight:22,font:w,tooltipShadowBlur:1},timeframeSelectorPlugin:{font:w,waterfallStrokeOpacity:1,waterfallFillOpacity:.1},timeGridPlugin:{font:w},waterfallPlugin:{defaultHeight:500}}}),[]);return t.jsx(B,{waterfall:i,onSelect:l,settings:n,onResize:(s,r,o)=>{s==null||s.setSettings({...n,styles:{...n.styles,waterfallPlugin:{defaultHeight:o}}}),clearTimeout(k),k=setTimeout(()=>{s==null||s.resize(r,o)},50)}})}function U({serverEvents:e,activeEventId:c,setActiveEventId:a}){let i=0,l=0;const n=P({serverEvents:e,buildMainRequest:(s,r)=>{var o;return i++,{id:s.id,requestId:s.requestId,url:s.url,status:((o=s.responseInit)==null?void 0:o.status)??0,cacheStatus:s.cacheStatus,duration:r.responseEnd-r.requestStart}},buildSubRequest:(s,r)=>{var o;return e.hidePutRequests?s.cacheStatus!=="PUT"&&l++:l++,{id:s.id,requestId:s.requestId,url:s.displayName??s.url,status:((o=s.responseInit)==null?void 0:o.status)??0,cacheStatus:s.cacheStatus,duration:r.requestEnd-r.requestStart}}});return u.useEffect(()=>{!e.preserveLog&&c&&(n.find(r=>r.id===c)||a(void 0))},[e.preserveLog]),t.jsx("div",{id:"request-table",children:t.jsxs("div",{children:[t.jsxs("div",{id:"request-table__header",className:"grid-row",children:[t.jsx("div",{className:"grid-cell",children:"Name"}),t.jsx("div",{className:"grid-cell",children:"Cache"}),t.jsx("div",{className:"grid-cell",children:"Time"})]}),t.jsx("div",{id:"request-table__content",children:n.map(s=>t.jsxs("div",{id:`request-table__row-${s.id}`,tabIndex:0,className:`grid-row${c===s.id?" active":""}${s.status>=400?" error":""}`,onClick:()=>a(s.id),onKeyUp:r=>{r.code==="Space"&&a(s.id)},children:[t.jsx("div",{className:"grid-cell",children:s.url}),t.jsx("div",{className:"grid-cell",children:s.cacheStatus}),t.jsxs("div",{className:"grid-cell",children:[s.duration,"ms"]})]},s.id))}),t.jsxs("div",{id:"request-table__footer",children:[i," request",i>1?"s":""," |"," ",l," sub request",l>1?"s":""]})]})})}const W="/assets/favicon-dark-B35gQ1-G.svg";function z(e){return t.jsxs("svg",{width:"20px",height:"20px",...e,stroke:e.stroke||"currentColor",children:[t.jsx("title",{children:"Close"}),t.jsx("line",{x1:"4.44194",y1:"4.30806",x2:"15.7556",y2:"15.6218",strokeWidth:"1.25"}),t.jsx("line",{y1:"-0.625",x2:"16",y2:"-0.625",transform:"matrix(-0.707107 0.707107 0.707107 0.707107 16 4.75)",strokeWidth:"1.25"})]})}const A=T,G={1:"General",2:"Headers",3:"Cache",4:"Data"};function Z({serverEvents:e,activeEventId:c,setActiveEventId:a}){var o,f,m,d,x,g,h,v,R;const[i,l]=u.useState(1);if(!c)return null;const n=e.allRequests[c];if(!n)return null;function s(j){return i===j?" active":""}function r(j){return t.jsx("div",{tabIndex:0,className:`tab${s(j)}`,onClick:()=>l(j),onKeyUp:N=>{N.code==="Space"&&l(j)},children:G[j]})}return t.jsxs("div",{id:"request-detail",children:[t.jsxs("div",{id:"request-detail-header",children:[t.jsxs(J,{children:[r(1),!!((o=n.responseInit)!=null&&o.headers)&&r(2),!!n.cache&&r(3),!!n.responsePayload&&r(4)]}),t.jsx("div",{id:"close-request-detail",children:t.jsx("button",{className:"plain icon",onClick:()=>{a(void 0)},children:t.jsx(z,{})})})]}),t.jsxs("div",{className:"tabPanels pad",children:[t.jsx("div",{id:"tab1-panel",className:`tabPanel${s(1)}`,children:t.jsxs("div",{className:"grid-layout",children:[t.jsx(b,{rowName:"Name",value:n.displayName}),t.jsx(b,{rowName:"Request URL",value:n.url}),n.responseInit?t.jsx(b,{rowName:"Status",value:`${(f=n.responseInit)==null?void 0:f.status} ${(m=n.responseInit)==null?void 0:m.statusText}`}):null,t.jsx(b,{rowName:"GraphiQL",value:n.graphiqlLink,type:"url"}),t.jsx(b,{rowName:"Location",text:n.stackLine,value:n.stackLink,type:"url"})]})}),!!((d=n.responseInit)!=null&&d.headers)&&t.jsx("div",{id:"tab2-panel",className:`tabPanel${s(2)}`,children:t.jsx("div",{className:"grid-layout",children:Object.entries((x=n.responseInit)==null?void 0:x.headers).map(([j,N])=>t.jsx(b,{rowName:N[0],value:N[1]},j))})}),!!n.cache&&t.jsx("div",{id:"tab3-panel",className:`tabPanel${s(3)}`,children:t.jsxs("div",{className:"grid-layout",children:[t.jsx(b,{rowName:"Status",value:(g=n.cache)==null?void 0:g.status}),t.jsx(b,{rowName:"Cache-Control",value:(h=n.cache)==null?void 0:h.strategy}),t.jsx(b,{rowName:"Cache Key",value:(R=(v=n.cache)==null?void 0:v.key)==null?void 0:R.toString()})]})}),!!n.responsePayload&&t.jsx("div",{id:"tab4-panel",className:`tabPanel${s(4)}`,children:t.jsx("pre",{className:"code-json",children:JSON.stringify(n.responsePayload,void 0,2)})})]})]})}function J({children:e}){const[c,a]=u.useState(""),i=u.useRef(null);A({ref:i,onResize:()=>{i.current&&l(i.current)}});function l(n){if(n.scrollWidth===n.clientWidth){a("");return}const s=n.scrollWidth-n.clientWidth;n.scrollLeft>10&&n.scrollLeft<s-10?a("fadeLeftRight"):n.scrollLeft<=10?a("fadeRight"):n.scrollLeft>s-10&&a("fadeLeft")}return t.jsxs("div",{id:"tab-buttons-wrapper",onResize:n=>l(n.currentTarget),children:[t.jsx("div",{id:"tabButtons",ref:i,className:"flex-row gap-tiny",onScroll:n=>l(n.currentTarget),children:e}),t.jsx("div",{className:`fadCover ${c}`})]})}function b({rowName:e,value:c,text:a,type:i="string"}){return!e||!c?null:t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"gridTitle",children:e}),i==="url"&&t.jsx(y,{target:"_blank",to:c,children:a??c}),i==="string"&&t.jsx("div",{className:"word-break-all",children:a??c})]})}function V(e){const c=e.fill||"#333333";return t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",...e,children:[t.jsx("title",{children:"Clear"}),t.jsx("path",{d:"M11.5 8.25C11.9142 8.25 12.25 8.58579 12.25 9V13.25C12.25 13.6642 11.9142 14 11.5 14C11.0858 14 10.75 13.6642 10.75 13.25V9C10.75 8.58579 11.0858 8.25 11.5 8.25Z",fill:c}),t.jsx("path",{d:"M9.25 9C9.25 8.58579 8.91421 8.25 8.5 8.25C8.08579 8.25 7.75 8.58579 7.75 9V13.25C7.75 13.6642 8.08579 14 8.5 14C8.91421 14 9.25 13.6642 9.25 13.25V9Z",fill:c}),t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.24994 5.25C7.24994 3.73122 8.48116 2.5 9.99994 2.5C11.5187 2.5 12.7499 3.73122 12.7499 5.25H15.75C16.1642 5.25 16.5 5.58579 16.5 6C16.5 6.41421 16.1642 6.75 15.75 6.75H14.9999L14.9998 12.2001C14.9998 13.8802 14.9997 14.7203 14.6728 15.362C14.3851 15.9265 13.9262 16.3854 13.3617 16.673C12.72 17 11.8799 17 10.1997 17H9.79999C8.11978 17 7.27968 17 6.63793 16.673C6.07343 16.3854 5.61448 15.9264 5.32687 15.3619C4.99989 14.7202 4.9999 13.8801 4.99994 12.1999L5.00005 6.75H4.25C3.83579 6.75 3.5 6.41421 3.5 6C3.5 5.58579 3.83579 5.25 4.25 5.25H7.24994ZM8.74994 5.25C8.74994 4.55964 9.30958 4 9.99994 4C10.6903 4 11.2499 4.55964 11.2499 5.25H8.74994ZM6.50007 6.75H13.4999L13.4998 12.2001C13.4998 13.0649 13.4986 13.6233 13.4639 14.0483C13.4305 14.4558 13.374 14.6068 13.3362 14.681C13.1924 14.9632 12.963 15.1927 12.6807 15.3365C12.6065 15.3743 12.4555 15.4308 12.048 15.4641C11.623 15.4988 11.0646 15.5 10.1997 15.5H9.79999C8.93513 15.5 8.37671 15.4988 7.95169 15.4641C7.54418 15.4308 7.3931 15.3743 7.31893 15.3365C7.03668 15.1927 6.80721 14.9632 6.6634 14.681C6.62561 14.6068 6.56909 14.4557 6.53581 14.0482C6.50109 13.6232 6.49994 13.0648 6.49995 12.1999L6.50007 6.75Z",fill:c})]})}const K="/assets/debug-network-mvOR6OhA.css",ce=()=>[{rel:"icon",type:"image/svg+xml",href:H},{rel:"stylesheet",href:K}],S={colors:{server:"#2ED389",streaming:"#33CCFF",subRequest:"#FFCC00"}};function le(){const{serverEvents:e,clear:c,timestamp:a,setHidePutRequests:i,setPreserveLog:l,setHideNotification:n}=D(),s=e.mainRequests.length===0;return t.jsxs("div",{id:"server-network-timing",className:`${e.hideNotification?"":"withNotification"}`,children:[t.jsx(O,{src:"https://unpkg.com/flame-chart-js@2.3.2/dist/index.min.js",suppressHydrationWarning:!0}),t.jsx(Q,{hideNotification:e.hideNotification,setHideNotification:n}),t.jsx(X,{}),t.jsxs("div",{id:"main",className:`${s?" empty":""}`,children:[t.jsx(ee,{serverEvents:e,clearCallback:c,setHidePutRequests:i,setPreserveLog:l}),t.jsx("div",{id:"request-waterfall",className:"pad",children:s?t.jsx(Y,{}):t.jsx("div",{className:"request-waterfall-chart",children:t.jsx(M,{serverEvents:e,config:S},a)})}),t.jsx(te,{serverEvents:e})]})]})}function Q({hideNotification:e,setHideNotification:c}){return e?null:t.jsxs("div",{className:"notification",children:[t.jsx("div",{id:"close-notification",children:t.jsx("button",{className:"plain icon",onClick:()=>{c(!0)},children:t.jsx(z,{})})}),t.jsx("p",{children:"Note: You may need to turn on 'Disable Cache' for your navigating window."})]})}function Y(){return t.jsxs("div",{id:"empty-view",children:[t.jsx("p",{className:"text-large bold",children:"Navigate to your app"}),t.jsx("p",{className:"text-normal",children:"Open your localhost to initiate subrequest profiler"}),t.jsx(y,{to:"/",target:"_blank",className:"link-margin-top",children:t.jsx("button",{className:"primary",children:"Open app"})})]})}function X(){return t.jsx("header",{className:"justify-between text-large",children:t.jsxs("div",{className:"flex-row",children:[t.jsx("img",{className:"logo",src:W,alt:"Hydrogen logo"}),t.jsx("h1",{children:"Subrequest Profiler"}),t.jsx("span",{className:"pill",children:"Development"})]})})}function ee({serverEvents:e,clearCallback:c,setHidePutRequests:a,setPreserveLog:i}){return t.jsxs("div",{id:"options-and-legend",className:"justify-between pad",children:[t.jsxs("div",{className:"flex-row text-large",children:[t.jsxs("button",{id:"buttonClear",onClick:()=>c(),children:[t.jsx(V,{}),t.jsx("span",{children:"Clear"})]}),t.jsxs("div",{className:"form-control",children:[t.jsx("input",{id:"hidePutRequests",type:"checkbox",checked:e.hidePutRequests,onChange:l=>a(l.target.checked)}),t.jsx("label",{htmlFor:"hidePutRequests",children:"Hide cache update requests (PUT)"})]}),t.jsxs("div",{className:"form-control",children:[t.jsx("input",{id:"preserveLog",type:"checkbox",checked:e.preserveLog,onChange:l=>i(l.target.checked)}),t.jsx("label",{htmlFor:"preserveLog",children:"Preserve Log"})]})]}),t.jsxs("div",{className:"flex-row text-normal gap-small",children:[t.jsxs("div",{className:"legend flex-row",children:[t.jsx("p",{className:"bold-1",children:"Main Request"}),t.jsxs("p",{className:"flex-row gap-small",children:[t.jsx("span",{className:"swatch",style:{backgroundColor:S.colors.server}}),"Time on server"]}),t.jsxs("p",{className:"flex-row gap-small",children:[t.jsx("span",{className:"swatch",style:{backgroundColor:S.colors.streaming}}),"Time to stream to client"]})]}),t.jsx("div",{className:"legend flex-row",children:t.jsxs("p",{className:"flex-row gap-small",children:[t.jsx("span",{className:"swatch",style:{backgroundColor:S.colors.subRequest}}),"Sub request"]})})]})]})}function te({serverEvents:e}){const[c,a]=u.useState();return u.useEffect(()=>{window.setActiveEventId=a},[]),u.useEffect(()=>{c||a(void 0)},[c]),t.jsxs("div",{id:"request-info",children:[t.jsx("div",{className:"overflow-hidden",children:t.jsx(U,{serverEvents:e,activeEventId:c,setActiveEventId:a})}),t.jsx("div",{id:"request-details-panel",className:`${c?"active":""}`,children:t.jsx(Z,{serverEvents:e,activeEventId:c,setActiveEventId:a})})]})}export{le as default,ce as links};
